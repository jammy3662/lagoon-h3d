#!/bin/bash

CLANG_FLAGS=" \
-fcolor-diagnostics \
-g3 \
-Wno-c++11-narrowing -Wno-write-strings -Wno-reserved-user-defined-literal \
\
-isystem src -isystem include \
"

echo "..."

mkdir -p bin

for i in $(find src -iname '*.cc')
do
	echo "$i --> bin/$(basename -s '.cc' "$i").o"
	clang++ -c "$i" -o "bin/$(basename -s '.cc' "$i").o" \
		$CLANG_FLAGS
done

clang++ bin/* -o lagoon $CLANG_FLAGS \
-Llib -lGL -lglad -lglfw \
$@ \
#2>&1 >/dev/null | grep -E 'error'

# capture clang error code
SUCCESS=$?

echo "..."

# it always comes back
rm -rf .vscode

exit $SUCCESS