#!/bin/bash

cd src

VERSION=$(date +%-y.%-V.%-u)
PLATFORM=$(uname -m)

clang++ main.cc -o ../lagoon \
\
	-DVERSION=\"$VERSION\" \
	-DPLATFORM=\"$PLATFORM\" \
\
	-fcolor-diagnostics \
	-g3 \
	-Wno-c++11-narrowing -Wno-write-strings -Wno-reserved-user-defined-literal \
\
	-Iinclude \
	-Llib \
	-lGL -lglad -lglfw \
	-lassimp \
$@ 2>&1 >/dev/null | grep -E 'error'

# capture clang error code
SUCCESS=$?

cd ..

# it always comes back
rm -rf .vscode

exit $SUCCESS